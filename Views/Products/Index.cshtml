@model IEnumerable<PesticideShop.Models.Product>
@using PesticideShop.Extensions

@{
    ViewData["Title"] = "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª";
    var lowStockProducts = Model.Where(p => p.Quantity <= 1).ToList();
    var totalProducts = Model.Count();
    var totalValue = Model.Sum(p => p.Quantity * p.Price);
    
    // Get top categories dynamically
    var topCategories = Model
        .Where(p => p.Category != null)
        .GroupBy(p => p.Category.Name)
        .Select(g => new { Name = g.Key, Count = g.Count() })
        .OrderByDescending(x => x.Count)
        .Take(4)
        .ToList();
}

<div class="page-container">
    <!-- Enhanced Page Header -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-title">
                <h1>ğŸ‘• Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª - Pharaonic</h1>
                <p>Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ø¹ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ø§Ù…Ù„Ø©</p>
            </div>
            <div class="header-actions">
                <button type="button" id="refreshProductsBtn" class="action-button info" onclick="refreshProductsData()">
                    ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
                <a asp-action="Create" class="action-button success">
                    â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
                </a>
                <form asp-action="RecalculateCostPrices" method="post" style="display: inline;">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="action-button warning" onclick="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙƒÙ„ÙØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ')">
                        ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø³Ø§Ø¨ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªÙƒÙ„ÙØ©
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Statistics Dashboard -->
    <div class="stats-section">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“¦</div>
                <div class="stat-content">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                    <div class="stat-value">@totalProducts</div>
                    <div class="stat-label">Ù…Ù†ØªØ¬</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <div class="stat-content">
                    <h3>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>
                    <div class="stat-value">@totalValue.ToString("N0")</div>
                    <div class="stat-label">Ø¬Ù†ÙŠÙ‡</div>
                </div>
            </div>
            @foreach (var category in topCategories)
            {
                <div class="stat-card">
                    <div class="stat-icon">ğŸ·ï¸</div>
                    <div class="stat-content">
                        <h3>@category.Name</h3>
                        <div class="stat-value">@category.Count</div>
                        <div class="stat-label">Ù…Ù†ØªØ¬</div>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Enhanced Search and Filter Section -->
    <div class="search-section">
        <div class="search-card">
            <div class="card-header">
                <h3>ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©</h3>
            </div>
            <div class="card-content">
                <div class="search-controls">
                    <div class="search-row">
                        <div class="search-item">
                            <input type="text" id="productSearch" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª..." class="search-input" />
                        </div>
                        <div class="filter-item">
                            <select id="categoryFilter" class="form-select">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙ†Ø§Ù</option>
                                @foreach (var category in Model.Where(p => p.Category != null).Select(p => p.Category.Name).Distinct().OrderBy(n => n))
                                {
                                    <option value="@category">@category</option>
                                }
                            </select>
                        </div>
                        <div class="filter-item">
                            <select id="stockFilter" class="form-select">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</option>
                                <option value="low">Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶</option>
                                <option value="normal">Ù…Ø®Ø²ÙˆÙ† Ø·Ø¨ÙŠØ¹ÙŠ</option>
                                <option value="out">Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</option>
                            </select>
                        </div>
                        <div class="search-actions">
                            <button type="button" id="clearFilters" class="action-button secondary">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Low Stock Alert -->
    @if (lowStockProducts.Any())
    {
        <div class="alert-section">
            <div class="alert-card warning">
                <div class="alert-header">
                    <h3>âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶</h3>
                    <span class="alert-count">@lowStockProducts.Count Ù…Ù†ØªØ¬</span>
                </div>
                <div class="alert-content">
                    <p>ÙŠÙˆØ¬Ø¯ @lowStockProducts.Count Ù…Ù†ØªØ¬ Ø¨ÙƒÙ…ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© (1 Ø£Ùˆ Ø£Ù‚Ù„) ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨</p>
                    <div class="low-stock-list">
                        @foreach (var product in lowStockProducts.Take(5))
                        {
                            <span class="stock-item">@product.Name (@product.Quantity)</span>
                        }
                        @if (lowStockProducts.Count > 5)
                        {
                            <span class="stock-item">Ùˆ @(lowStockProducts.Count - 5) Ù…Ù†ØªØ¬ Ø¢Ø®Ø±</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Enhanced Products Table -->
    @if (Model.Any())
    {
        <div class="table-section">
            <div class="section-header">
                <h3>ğŸ‘• Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                <div class="table-controls">
                    <span class="total-count">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: @Model.Count()</span>
                    <div class="table-actions">
                        <button type="button" id="exportTable" class="action-button info" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„">
                            ğŸ“Š ØªØµØ¯ÙŠØ±
                        </button>
                        <button type="button" id="printTable" class="action-button secondary" title="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="table-container">
                <table class="data-table" id="productsTable">
                    <thead>
                        <tr>
                            <th data-sortable="true" class="qr-header">ğŸ“± Ø±Ù…Ø² QR</th>
                            <th data-sortable="true" class="name-header">ğŸ‘• Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th data-sortable="true" class="category-header">ğŸ·ï¸ Ø§Ù„ØµÙ†Ù</th>
                            <th data-sortable="true" class="color-header">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</th>
                            <th data-sortable="true" class="size-header">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³</th>
                            <th data-sortable="true" class="quantity-header">ğŸ“Š Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th data-sortable="true" class="price-header">ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
                            <th data-sortable="true" class="cost-header">ğŸ’µ Ø³Ø¹Ø± Ø§Ù„Ø¬Ù…Ù„Ù‡</th>
                            <th data-sortable="true" class="total-header">ğŸ’µ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                            <th class="actions-header">ğŸ”§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            var itemTotalValue = item.Quantity * item.Price;
                            var isLowStock = item.Quantity <= 1;
                            var isOutOfStock = item.Quantity <= 0;
                            
                            <tr class="@(isLowStock ? "low-stock-row" : "") @(isOutOfStock ? "out-of-stock-row" : "")" 
                                data-category="@(item.Category?.Name ?? "")" 
                                data-stock="@(isOutOfStock ? "out" : isLowStock ? "low" : "normal")"
                                data-qr="@item.QRCode"
                                data-name="@item.Name"
                                data-color="@item.Color">
                                <td class="qr-code-cell">
                                    <div class="qr-display">
                                        <span class="qr-text">@item.QRCode</span>
                                        @if (!string.IsNullOrEmpty(item.QRCode))
                                        {
                                            <div class="qr-buttons">
                                                <button type="button" class="qr-copy-btn" 
                                                        data-qr="@item.QRCode"
                                                        data-product-id="@item.Id"
                                                        data-product-name="@Html.Raw(item.Name.Replace("\"", "&quot;"))"
                                                        data-product-price="@item.Price"
                                                        data-product-quantity="@item.Quantity"
                                                        data-product-category="@Html.Raw(item.Category?.Name?.Replace("\"", "&quot;") ?? "")"
                                                        data-product-color="@Html.Raw(item.Color?.Replace("\"", "&quot;") ?? "")"
                                                        data-product-size="@item.Size"
                                                        onclick="copyProductQR(this)" 
                                                        title="Ù†Ø³Ø® Ø±Ù…Ø² QR Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ (Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù„ØµÙ‚)">
                                                    ğŸ“‹ Ù†Ø³Ø® ÙƒØ§Ù…Ù„
                                            </button>
                                                <button type="button" class="qr-copy-simple-btn" 
                                                        onclick="copyToClipboard('@item.QRCode')" 
                                                        title="Ù†Ø³Ø® Ø±Ù…Ø² QR ÙÙ‚Ø·">
                                                    ğŸ“„ QR ÙÙ‚Ø·
                                                </button>
                                            </div>
                                        }
                                    </div>
                                </td>
                                <td class="product-name-cell">
                                    <div class="product-info">
                                        <div class="product-name">@item.Name</div>
                                        @if (!string.IsNullOrEmpty(item.Notes))
                                        {
                                            <div class="product-notes">@item.Notes</div>
                                        }
                                    </div>
                                </td>
                                <td class="category-cell">
                                    @if (item.Category != null)
                                    {
                                        <span class="category-tag @(item.Category.Name.ToLower().Replace(" ", "-"))">
                                            @item.Category.Name
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="category-tag undefined">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    }
                                </td>
                                <td class="color-cell">
                                    @if (!string.IsNullOrEmpty(item.Color))
                                    {
                                        <div class="color-display">
                                            <span class="color-dot" style="background-color: @item.Color;" title="@item.Color"></span>
                                            <span class="color-text">@item.Color</span>
                                        </div>
                                    }
                                    else
                                    {
                                        <span class="no-color">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    }
                                </td>
                                <td class="size-cell">
                                    @if (item.Size != 0)
                                    {
                                        <span class="size-tag">@item.Size.GetDisplayName()</span>
                                    }
                                    else
                                    {
                                        <span class="size-tag undefined">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    }
                                </td>
                                <td class="quantity-cell @(isLowStock ? "low-stock" : "") @(isOutOfStock ? "out-of-stock" : "")">
                                    <div class="quantity-display">
                                        <span class="quantity-value">@item.Quantity</span>
                                        @if (isLowStock)
                                        {
                                            <span class="low-stock-indicator" title="Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶">âš ï¸</span>
                                        }
                                        @if (isOutOfStock)
                                        {
                                            <span class="out-of-stock-indicator" title="Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">âŒ</span>
                                        }
                                    </div>
                                </td>
                                <td class="price-cell">
                                    <div class="price-display">
                                        <span class="price-value">@item.Price.ToString("N2")</span>
                                        <span class="price-currency">Ø¬Ù†ÙŠÙ‡</span>
                                    </div>
                                </td>
                                <td class="cost-price-cell">
                                    <div class="cost-display">
                                        <span class="cost-value">@(item.CartonPrice?.ToString("N2") ?? "ØºÙŠØ± Ù…Ø­Ø¯Ø¯")</span>
                                        <span class="cost-currency">Ø¬Ù†ÙŠÙ‡</span>
                                    </div>
                                </td>
                                <td class="total-value-cell">
                                    <div class="total-display">
                                        <span class="total-value">@itemTotalValue.ToString("N2")</span>
                                        <span class="total-currency">Ø¬Ù†ÙŠÙ‡</span>
                                    </div>
                                </td>
                                <td class="actions-cell">
                                    <div class="action-buttons">
                                        <a asp-action="Details" asp-route-id="@item.Id" 
                                           class="action-btn view" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                            ğŸ‘ï¸
                                        </a>
                                        <a asp-action="Edit" asp-route-id="@item.Id" 
                                           class="action-btn edit" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬">
                                            âœï¸
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.Id" 
                                           class="action-btn delete" title="Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬">
                                            ğŸ—‘ï¸
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info" id="productsPaginationInfo"></div>
                <div class="pagination-controls" id="productsPaginationControls"></div>
            </div>
        </div>
    }
    else
    {
        <div class="empty-state">
            <div class="empty-icon">ğŸ“¦</div>
            <h4>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</h4>
            <p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ù†ØªØ¬ Ù„ØªÙ†Ø¸ÙŠÙ… Ù…Ø®Ø²ÙˆÙ†Ùƒ.</p>
            <a asp-action="Create" class="action-button primary">
                â• Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ù†ØªØ¬
            </a>
        </div>
    }
</div>

<style>
/* Enhanced styling for the products table */
.qr-code-cell {
    min-width: 120px;
}

.qr-display {
    display: flex;
    align-items: center;
    gap: 8px;
}

.qr-text {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    color: #2c3e50;
    background: #f8f9fa;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #dee2e6;
}

.qr-buttons {
    display: flex;
    gap: 4px;
    margin-top: 4px;
}

.qr-copy-btn, .qr-copy-simple-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s;
    font-size: 0.8em;
    font-weight: 500;
}

.qr-copy-btn {
    background-color: #007bff;
    color: white;
}

.qr-copy-btn:hover {
    background-color: #0056b3;
    transform: translateY(-1px);
}

.qr-copy-simple-btn {
    background-color: #6c757d;
    color: white;
}

.qr-copy-simple-btn:hover {
    background-color: #545b62;
    transform: translateY(-1px);
}

.product-name-cell {
    min-width: 200px;
}

.product-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.product-name {
    font-weight: 600;
    color: #2c3e50;
}

.product-notes {
    font-size: 0.85em;
    color: #6c757d;
    font-style: italic;
}

.category-cell {
    min-width: 120px;
}

.category-tag {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 500;
    text-align: center;
    min-width: 80px;
}

.category-tag.clothing { background-color: #e3f2fd; color: #1976d2; }
.category-tag.electronics { background-color: #f3e5f5; color: #7b1fa2; }
.category-tag.food { background-color: #e8f5e8; color: #388e3c; }
.category-tag.undefined { background-color: #f5f5f5; color: #757575; }

.color-cell {
    min-width: 100px;
}

.color-display {
    display: flex;
    align-items: center;
    gap: 8px;
}

.color-dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 1px #dee2e6;
}

.color-text {
    font-size: 0.9em;
    color: #495057;
}

.no-color {
    color: #6c757d;
    font-style: italic;
    font-size: 0.85em;
}

.size-cell {
    min-width: 100px;
}

.size-tag {
    display: inline-block;
    padding: 3px 10px;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 15px;
    font-size: 0.85em;
    color: #495057;
}

.size-tag.undefined {
    background-color: #f5f5f5;
    color: #757575;
}

.quantity-cell {
    min-width: 100px;
}

.quantity-display {
    display: flex;
    align-items: center;
    gap: 6px;
}

.quantity-value {
    font-weight: 600;
    color: #2c3e50;
}

.low-stock-indicator, .out-of-stock-indicator {
    font-size: 1.2em;
}

.low-stock-row {
    background-color: #fff3cd;
}

.out-of-stock-row {
    background-color: #f8d7da;
}

.price-cell, .cost-price-cell, .total-value-cell {
    min-width: 120px;
}

.price-display, .cost-display, .total-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
}

.price-value, .cost-value, .total-value {
    font-weight: 600;
    color: #2c3e50;
}

.price-currency, .cost-currency, .total-currency {
    font-size: 0.8em;
    color: #6c757d;
}

.actions-cell {
    min-width: 120px;
}

.action-buttons {
    display: flex;
    gap: 6px;
    justify-content: center;
}

/* Header Action Buttons */
.header-actions .action-button {
    display: inline-block;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer;
    margin-left: 10px;
}

.header-actions .action-button.info {
    background: linear-gradient(135deg, #007bff, #17a2b8);
    color: white;
}

.header-actions .action-button.info:hover {
    background: linear-gradient(135deg, #0056b3, #138496);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
}

.header-actions .action-button.info:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
    opacity: 0.7;
}

.header-actions .action-button.success {
    background: linear-gradient(135deg, #28a745, #34ce57);
    color: white;
}

.header-actions .action-button.success:hover {
    background: linear-gradient(135deg, #218838, #28a745);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(40,167,69,0.3);
}

.action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 6px;
    text-decoration: none;
    transition: all 0.2s;
    font-size: 1.1em;
}

.action-btn.view {
    background-color: #17a2b8;
    color: white;
}

.action-btn.edit {
    background-color: #ffc107;
    color: #212529;
}

.action-btn.delete {
    background-color: #dc3545;
    color: white;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Responsive table */
@@media (max-width: 1200px) {
    .table-container {
        overflow-x: auto;
    }
    
    .data-table {
        min-width: 1000px;
    }
}

/* Animation for table rows */
.animate-in {
    animation: fadeInUp 0.3s ease-out;
}

@@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>

<script>
// Enhanced JavaScript for Products page
document.addEventListener('DOMContentLoaded', function() {
    initializeProductsPage();
    initializeProductsPagination();
});

function initializeProductsPage() {
    // Search functionality
    const searchInput = document.getElementById('productSearch');
    const categoryFilter = document.getElementById('categoryFilter');
    const stockFilter = document.getElementById('stockFilter');
    const clearFiltersBtn = document.getElementById('clearFilters');
    const table = document.getElementById('productsTable');
    const rows = table.querySelectorAll('tbody tr');

    function filterTable() {
        const searchTerm = searchInput.value.toLowerCase();
        const categoryValue = categoryFilter.value;
        const stockValue = stockFilter.value;

        rows.forEach(row => {
            const productName = row.querySelector('.product-name').textContent.toLowerCase();
            const qrCode = row.getAttribute('data-qr') || '';
            const category = row.getAttribute('data-category');
            const stock = row.getAttribute('data-stock');
            const color = row.getAttribute('data-color') || '';

            const matchesSearch = productName.includes(searchTerm) || 
                                qrCode.toLowerCase().includes(searchTerm) ||
                                color.toLowerCase().includes(searchTerm);
            const matchesCategory = !categoryValue || category === categoryValue;
            const matchesStock = !stockValue || stock === stockValue;

            if (matchesSearch && matchesCategory && matchesStock) {
                row.style.display = '';
                row.classList.add('animate-in');
            } else {
                row.style.display = 'none';
                row.classList.remove('animate-in');
            }
        });

        updateTableStats();
    }

    function updateTableStats() {
        const visibleRows = Array.from(rows).filter(row => row.style.display !== 'none');
        const totalCount = document.querySelector('.total-count');
        if (totalCount) {
            totalCount.textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${visibleRows.length}`;
        }
    }

    // Event listeners
    searchInput.addEventListener('input', filterTable);
    categoryFilter.addEventListener('change', filterTable);
    stockFilter.addEventListener('change', filterTable);
    
    clearFiltersBtn.addEventListener('click', function() {
        searchInput.value = '';
        categoryFilter.value = '';
        stockFilter.value = '';
        filterTable();
    });

    // Export functionality
    document.getElementById('exportTable').addEventListener('click', function() {
        exportTableToCSV();
    });

    // Print functionality
    document.getElementById('printTable').addEventListener('click', function() {
        window.print();
    });

    // Initialize table sorting
    initializeTableSorting();
}

// Client-side pagination for products table (styled like the new pagination)
function initializeProductsPagination() {
    const rowsPerPage = 10;
    const table = document.getElementById('productsTable');
    if (!table) return;
    const rows = Array.from(table.querySelectorAll('tbody tr'));
    const info = document.getElementById('productsPaginationInfo');
    const controls = document.getElementById('productsPaginationControls');
    if (!info || !controls) return;

    function render(pageIndex) {
        const total = rows.length;
        const totalPages = Math.max(1, Math.ceil(total / rowsPerPage));
        const page = Math.min(Math.max(1, pageIndex), totalPages);
        const start = (page - 1) * rowsPerPage;
        const end = Math.min(start + rowsPerPage, total);

        rows.forEach((row, idx) => {
            row.style.display = idx >= start && idx < end ? '' : 'none';
        });

        info.textContent = `Ø¹Ø±Ø¶ ${start + 1} Ø¥Ù„Ù‰ ${end} Ù…Ù† ${total} Ù…Ù†ØªØ¬`;

        // build controls
        controls.innerHTML = '';
        const frag = document.createDocumentFragment();
        
        function btn(label, cls, disabled, targetPage) {
            const b = document.createElement('button');
            b.className = `pagination-btn ${cls || ''}`.trim();
            b.textContent = label;
            if (disabled) b.disabled = true;
            b.addEventListener('click', () => render(targetPage));
            frag.appendChild(b);
        }

        // Add page number buttons (show only 5 buttons max around current page)
        const maxVisible = 5;
        let startPage, endPage;
        
        if (totalPages <= maxVisible) {
            // Show all pages if total is less than max
            startPage = 1;
            endPage = totalPages;
        } else {
            // Calculate range around current page
            const halfVisible = Math.floor(maxVisible / 2);
            startPage = Math.max(1, page - halfVisible);
            endPage = Math.min(totalPages, page + halfVisible);
            
            // Adjust if we're near the start or end
            if (page <= halfVisible) {
                endPage = maxVisible;
            } else if (page >= totalPages - halfVisible) {
                startPage = totalPages - maxVisible + 1;
            }
        }
        
        for (let p = startPage; p <= endPage; p++) {
            const b = document.createElement('button');
            b.className = 'pagination-btn' + (p === page ? ' active' : '');
            b.textContent = p.toString();
            b.addEventListener('click', () => render(p));
            frag.appendChild(b);
        }
        
        // Add "Ø§Ù„ØªØ§Ù„ÙŠØ©" (Next) button
        btn('Ø§Ù„ØªØ§Ù„ÙŠØ©', 'next', page === totalPages, page + 1);
        
        // Add "Ø§Ù„Ø£Ø®ÙŠØ±Ø©" (Last) button
        btn('Ø§Ù„Ø£Ø®ÙŠØ±Ø©', 'last', page === totalPages, totalPages);
        
        controls.appendChild(frag);
    }

    render(1);
}

// Copy QR code to clipboard with enhanced data
function copyProductQR(button) {
    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† attributes Ø§Ù„Ø²Ø±
    const qrCode = button.getAttribute('data-qr');
    const productData = {
        id: parseInt(button.getAttribute('data-product-id')),
        name: button.getAttribute('data-product-name'),
        price: parseFloat(button.getAttribute('data-product-price')),
        quantity: parseInt(button.getAttribute('data-product-quantity')),
        category: button.getAttribute('data-product-category'),
        color: button.getAttribute('data-product-color'),
        size: parseInt(button.getAttribute('data-product-size'))
    };
    
    console.log('ğŸ“‹ Ù†Ø³Ø® QR:', qrCode);
    console.log('ğŸ“¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬:', productData);
    
    // Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬
    const qrData = {
        qrCode: qrCode,
        timestamp: new Date().toISOString(),
        source: 'products_page',
        productInfo: productData
    };
    
    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ JSON
    const qrDataString = JSON.stringify(qrData);
    
    console.log('ğŸ“„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„Ù„Ø­Ø§ÙØ¸Ø©:', qrDataString);
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(qrDataString).then(function() {
            showCopyNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² QR Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬! Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù„ØµÙ‚ ÙÙŠ Ø§Ù„ÙƒØ§Ø´ÙŠØ±', 'success');
            // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù†Ø³ÙˆØ®
            highlightCopiedElement(button);
        }).catch(function(error) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', error);
            // Fallback: Ù†Ø³Ø® QR ÙÙ‚Ø·
            navigator.clipboard.writeText(qrCode).then(function() {
                showCopyNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² QR!', 'success');
                highlightCopiedElement(button);
            }).catch(function(err) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø¨Ø¯ÙŠÙ„:', err);
                showCopyNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø±Ù…Ø² QR', 'error');
            });
        });
    } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = qrDataString;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            showCopyNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² QR Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬! Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ù„ØµÙ‚ ÙÙŠ Ø§Ù„ÙƒØ§Ø´ÙŠØ±', 'success');
            highlightCopiedElement(button);
        } catch (err) {
            console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…:', err);
            // Fallback: Ù†Ø³Ø® QR ÙÙ‚Ø·
            textArea.value = qrCode;
            textArea.select();
            try {
                document.execCommand('copy');
                showCopyNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² QR!', 'success');
                highlightCopiedElement(button);
            } catch (err2) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø¨Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ…:', err2);
                showCopyNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø±Ù…Ø² QR', 'error');
            }
        }
        document.body.removeChild(textArea);
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ø¨ØµØ±ÙŠ Ù„Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù…Ù†Ø³ÙˆØ®
function highlightCopiedElement(button) {
    // Ø­ÙØ¸ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
    const originalText = button.innerHTML;
    
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¨ØµØ±ÙŠ
    button.style.backgroundColor = '#28a745';
    button.style.color = 'white';
    button.style.transform = 'scale(1.1)';
    button.innerHTML = 'âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®';
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
    setTimeout(() => {
        button.style.backgroundColor = '';
        button.style.color = '';
        button.style.transform = '';
        button.innerHTML = originalText;
    }, 2000);
}

// Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø¨Ø³ÙŠØ·Ø© (Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù‚Ø¯ÙŠÙ…)
function copyToClipboard(qrCode) {
    if (navigator.clipboard) {
        navigator.clipboard.writeText(qrCode).then(function() {
            showCopyNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² QR!', 'success');
        }).catch(function() {
            showCopyNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø±Ù…Ø² QR', 'error');
        });
    } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = qrCode;
        document.body.appendChild(textArea);
        textArea.select();
        try {
            document.execCommand('copy');
            showCopyNotification('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² QR!', 'success');
        } catch (err) {
            showCopyNotification('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø±Ù…Ø² QR', 'error');
        }
        document.body.removeChild(textArea);
    }
}

// Show copy notification
function showCopyNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `copy-notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 6px;
        color: white;
        font-weight: 500;
        z-index: 1000;
        animation: slideInRight 0.3s ease-out;
    `;
    
    if (type === 'success') {
        notification.style.backgroundColor = '#28a745';
    } else {
        notification.style.backgroundColor = '#dc3545';
    }
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-out';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 2000);
}

// Add CSS animations for notifications
const style = document.createElement('style');
style.textContent = `
    @@keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @@keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function exportTableToCSV() {
    const table = document.getElementById('productsTable');
    const rows = Array.from(table.querySelectorAll('tr'));
    
    let csv = [];
    rows.forEach(row => {
        const cols = Array.from(row.querySelectorAll('td, th'));
        const rowData = cols.map(col => {
            // Remove emojis and get clean text
            return col.textContent.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '').trim();
        });
        csv.push(rowData.join(','));
    });
    
    const csvContent = csv.join('\n');
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', 'products.csv');
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function initializeTableSorting() {
    const headers = document.querySelectorAll('th[data-sortable]');
    headers.forEach(header => {
        header.addEventListener('click', function(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const column = Array.from(header.parentElement.children).indexOf(header);
            const table = header.closest('table');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            const isAscending = !header.classList.contains('sort-asc');
            
            // Remove existing sort classes from all headers in this table
            const tableHeaders = table.querySelectorAll('th[data-sortable]');
            tableHeaders.forEach(h => h.classList.remove('sort-asc', 'sort-desc'));
            
            // Add sort class
            header.classList.add(isAscending ? 'sort-asc' : 'sort-desc');
            
            // Sort rows
            rows.sort((a, b) => {
                const aCell = a.children[column];
                const bCell = b.children[column];
                
                if (!aCell || !bCell) return 0;
                
                let aValue = aCell.textContent.trim();
                let bValue = bCell.textContent.trim();
                
                // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ù…ÙˆØ² Ø§Ù„ØªØ¹Ø¨ÙŠØ±ÙŠØ© ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
                aValue = aValue.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
                bValue = bValue.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
                const aNum = parseFloat(aValue.replace(/[^\d.-]/g, ''));
                const bNum = parseFloat(bValue.replace(/[^\d.-]/g, ''));
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    // ØªØ±ØªÙŠØ¨ Ø±Ù‚Ù…ÙŠ
                    if (isAscending) {
                        return aNum - bNum;
                    } else {
                        return bNum - aNum;
                    }
                } else {
                    // ØªØ±ØªÙŠØ¨ Ù†ØµÙŠ
                    if (isAscending) {
                        return aValue.localeCompare(bValue, 'ar');
                    } else {
                        return bValue.localeCompare(aValue, 'ar');
                    }
                }
            });
            
            // Reorder rows with animation
            rows.forEach((row, index) => {
                row.style.opacity = '0';
                row.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    tbody.appendChild(row);
                    row.style.transition = 'all 0.3s ease';
                    row.style.opacity = '1';
                    row.style.transform = 'translateY(0)';
                }, index * 50);
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
            const sortDirection = isAscending ? 'ØªØµØ§Ø¹Ø¯ÙŠ' : 'ØªÙ†Ø§Ø²Ù„ÙŠ';
            const columnName = header.textContent.trim().replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');

        });
    });
}

// Close modal when clicking outside
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}

// Refresh products data function
async function refreshProductsData() {
    const refreshBtn = document.getElementById('refreshProductsBtn');
    
    try {
        // Show loading state
        refreshBtn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
        refreshBtn.disabled = true;
        
        const response = await fetch('/Products/RefreshProductsData');
        const result = await response.json();
        
        if (result.success) {
            // Update quantities in the table
            result.products.forEach(product => {
                updateProductQuantityInTable(product.id, product.quantity);
            });
            
            // Show success message
            showMessage(result.message || 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
           
        } else {
            showMessage(result.message || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
           
        }
    } catch (error) {
        console.error('âŒ Error refreshing products data:', error);
        showMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…', 'error');
    } finally {
        // Reset button state
        refreshBtn.innerHTML = 'ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        refreshBtn.disabled = false;
    }
}

// Update specific product quantity in table
function updateProductQuantityInTable(productId, newQuantity) {
    const table = document.getElementById('productsTable');
    if (!table) return;
    
    // Find the row with this product
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
        const editLink = row.querySelector('a[href*="Edit/' + productId + '"]');
        if (editLink) {
            const quantityCell = row.querySelector('.quantity-cell .quantity-value');
            if (quantityCell) {
                const oldQuantity = parseInt(quantityCell.textContent);
                quantityCell.textContent = newQuantity;
                
                // Update stock indicators
                const quantityDisplay = row.querySelector('.quantity-display');
                const lowStockIndicator = quantityDisplay.querySelector('.low-stock-indicator');
                const outOfStockIndicator = quantityDisplay.querySelector('.out-of-stock-indicator');
                
                // Remove existing indicators
                if (lowStockIndicator) lowStockIndicator.remove();
                if (outOfStockIndicator) outOfStockIndicator.remove();
                
                // Add new indicators if needed
                if (newQuantity <= 0) {
                    quantityDisplay.innerHTML += '<span class="out-of-stock-indicator" title="Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†">âŒ</span>';
                    row.classList.add('out-of-stock-row');
                    row.classList.remove('low-stock-row');
                } else if (newQuantity <= 1) {
                    quantityDisplay.innerHTML += '<span class="low-stock-indicator" title="Ù…Ø®Ø²ÙˆÙ† Ù…Ù†Ø®ÙØ¶">âš ï¸</span>';
                    row.classList.add('low-stock-row');
                    row.classList.remove('out-of-stock-row');
                } else {
                    row.classList.remove('low-stock-row', 'out-of-stock-row');
                }
                
                // Highlight changed quantity
                if (oldQuantity !== newQuantity) {
                    quantityCell.style.backgroundColor = '#d4edda';
                    quantityCell.style.color = '#155724';
                    setTimeout(() => {
                        quantityCell.style.backgroundColor = '';
                        quantityCell.style.color = '';
                    }, 2000);
                }
                
               
            }
        }
    });
}

// Simple toast notification function
function showMessage(message, type = 'info') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <span class="toast-icon">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
            <span class="toast-message">${message}</span>
        </div>
    `;
    
    // Add styles if not exist
    if (!document.querySelector('#toast-styles')) {
        const style = document.createElement('style');
        style.id = 'toast-styles';
        style.textContent = `
            .toast {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            }
            .toast-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
            .toast-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
            .toast-info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
            .toast-content { display: flex; align-items: center; gap: 10px; }
            @@keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
        `;
        document.head.appendChild(style);
    }
    
    // Add to page
    document.body.appendChild(toast);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
</script>